/* 
	Created by Jactari
	Updated by Aspirin and Aendawyn
	Maintained by Aendawyn

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.
	
	You should have received a copy of the GNU General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
	
*/

jQuery.preloadImages=function(){
    for(var i=0;i<arguments[0].length;i++){
        if(typeof arguments[0][i]!='undefined')jQuery('<img>').attr('src',_base_url+'images/'+arguments[0][i])
    }
};

var images={
    accueil:['icone-accueil.png'],
    heros:['icone-heros.png','cadre-heros.png','Hero_ACADEMY_2.png','Hero_HAVEN_2.png','Hero_INFERNO_2.png','Hero_NECROPOLIS_2.png','Hero_SYLVAN_2.png','Hero_DUNGEON_2.png','HeroClass.png','HeroClassSkill.png','bandeau-guerrier.png','bandeau-mage.png','bandeau-mage-guerrier.png','hero-green.png','hero-purple.png','hero-red.png','hero-other.png','emplacements-artefacts.png','artefact-inconnu.png','equipe.png','info.png','info-survol.png','common.png','fond-xp.png'],
    combat:['icone-combat.png','UnitStack_ACADEMY.png','UnitStack_NEUTRAL.png','UnitStack_HAVEN.png','UnitStack_INFERNO.png','UnitStack_NECROPOLIS.png','UnitStack_SYLVAN.png','UnitStack_FORTRESS.png','UnitStack_DUNGEON.png','plus-un.png','plus-dix.png','moins-un.png','moins-dix.png','plus-survol.png','moins-survol.png','plus-cent.png','moins-cent.png','fleche-haut.png','fleche-bas.png','fleche-haut-survol.png','fleche-bas-survol.png','plus.png','moins.png','inversion.png','croix.png','croix-survol.png','unite-absente.png','unite-suppression.png','fond-competences-speciales.jpg','fond-heredite.jpg','fond-noir-translucide.png','fonds-sorts.jpg'],
    artefacts:['icone-artefact.png'],
    creatures:['icone-troupes.png'],
    sorts:['icone-sorts.png'],
    stats:['icone-stats.png'],
    creatures_combat:['BattleUnitStack_ACADEMY.jpg','BattleUnitStack_NEUTRAL.jpg','BattleUnitStack_HAVEN.jpg','BattleUnitStack_INFERNO.jpg','BattleUnitStack_NECROPOLIS.jpg','BattleUnitStack_SYLVAN.jpg','BattleUnitStack_FORTRESS.jpg','BattleUnitStack_DUNGEON.jpg','Ressources.png'],
    artefacts_heros:['Artefact_ACADEMY.png','Artefact_COMMON.png','Artefact_HAVEN.png','Artefact_INFERNO.png','Artefact_NECROPOLIS.png','Artefact_REWARD.png','Artefact_HEREDITY.png','Artefact_SYLVAN.png','Artefact_SET.png'],
    combat_sorts:['SpellStack_DARK.png','SpellStack_DESTRUCTION.png','SpellStack_LIGHT.png','SpellStack_SUMMON.png'],
    commun:['score-rempli.png','score-vide.png','unite.png','UnitStack_types.png'],
    heredite:['BonusIcon_HEREDITY_d5x3.png']
};

var _images=images.commun.concat(images[_page]);
if(_page=='artefacts')_images=_images.concat(images.artefacts_heros);
if(_page=='combat')_images=_images.concat(images.creatures_combat,images.combat_sorts,images.heredite);
if(_page=='creatures')_images=_images.concat(images.creatures_combat);
if(_page=='heros')_images=_images.concat(images.artefacts_heros);
if(_page=='sorts')_images=_images.concat(images.combat_sorts);
function image_html_troupe(troupe,type_image,id,classe){
    var nom=_unites[troupe].nom[_langue];
    var faction=_unites[troupe].faction;
    var icone=_unites[troupe].icone;
    if (faction == -1) {
        faction = 'NEUTRAL';
    } else if (faction == -2) {
        faction = 'NEW';
    } else {
        faction = _factions[faction].nom['en'].toUpperCase();
    }
    var vaincue=type_image&8;
    var grisee=type_image&4;
    type_image&=3;
    switch(type_image){
        case 2:
            var h=22;
            var l=23;
            var x=(icone-1)*-23;
            var style='vertical-align: middle;';
            var image='UnitStack_'+faction+'.png';
            break;
        case 3:
            var h=22;
            var l=23;
            var x=(icone-1)*-23;
            var style='margin-right: 1em; vertical-align: middle;';
            var image='UnitStack_'+faction+'.png';
            break;
        case 1:default:
            var h=52;
            var l=51;
            var x=(icone-1)*-51;
            var style=' display: block;';
            var image='BattleUnitStack_'+faction+'.jpg';
            break
    }
    var y=0;
    if(grisee)y=-22;
    if(vaincue)y=-52;
    var html='<img src="'+_base_url+'images/unite.png"';
    html+=' alt="'+nom+'" title="'+nom+'"';
    html+=' width="'+l+'px" height="'+h+'px"';
    if(id!==undefined)html+=' id="'+id+'"';
    if(classe!==undefined)html+=' class="'+classe+'"';
    html+=' style="background: url('+_base_url+'images/'+image+') no-repeat '+x+'px '+y+'px;'+style+'"';
    html+=' />';
    return html
};

function image_css_troupe(id,type) {
    if (type == -1) {
        $('img#'+id).css('background','url('+_base_url+'images/unite-absente.png) no-repeat 0px 0px')
    } else {
        var unite = _unites[type];
        if (unite.faction == -1) {
            var faction = 'NEUTRAL';
        } else if (unite.faction == -2) {
            var faction = 'NEW';
        } else {
            var faction = _factions[unite.faction].nom['en'].toUpperCase();
        }
        var x = (unite.icone-1)*-23;
        $('img#'+id).css('background','url('+_base_url+'images/UnitStack_'+faction+'.png) no-repeat '+x+'px 0px');
        $('img#'+id).attr('alt',unite.nom[_langue]).attr('title',unite.nom[_langue])
    }
};

function image_html_arme(arme,bonus,inline,titre){
    if(inline===undefined)inline=false;
    if(titre===undefined)titre='X';
    if(arme==='')return'';
    switch(arme){
        case'I':
            var x=0;
            break;
        case'R':
            var x=-22;
            break;
        case'C':
            var x=-44;
            break;
        default:
            return''
    }
    switch(bonus){
        case 0:
            var y=0;
            break;
        case 1:
            var y=-22;
            break;
        case-1:
            var y=-44;
            break;
        default:
            return''
    }
    var html='<img src="'+_base_url+'images/unite.png"';
    html+=' class="arme"';
    html+=' alt="'+_armes[arme][_langue]+'" title="'+titre.replace(/X/,_armes[arme][_langue])+'"';
    html+=' style="background: url('+_base_url+'images/UnitStack_types.png) no-repeat '+x+'px '+y+'px;';
    if(inline)html+='display:inline-block;vertical-align:middle;';
    html+='" />';
    return html
};

function image_html_sort(id){
    var nom=_sorts[id].nom[_langue];
    var icone=_sorts[id].icone;
    var ecole=_ecoles_magie[_sorts[id].ecole].nom_machine;
    if(icone!==undefined){
        var x=(icone-1)*-40;
        var y=0
    }else{
        var x=0;
        var y=-120
    }
    var html='<img src="'+_base_url+'images/unite.png"';
    html+=' width="40px" height="40px"';
    html+=' alt="'+nom+'" title="'+nom+'"';
    html+=' style="background: url('+_base_url+'images/SpellStack_'+ecole+'.png) no-repeat '+x+'px '+y+'px"';
    html+=' class="icone-sort" />';
    return html
};

function image_html_score(score,maximum){
    var div_style='background: url('+_base_url+'images/score-vide.png) no-repeat left top; border:none; display: block; height: 8px; margin:0 auto; padding:0; vertical-align: top; width: '+(maximum*8)+'px;';
    var img_src=_base_url+'images/unite.png';
    var img_style='background: url('+_base_url+'images/score-rempli.png) no-repeat -'+((10-score)*8)+'px top; border:none; display: block; height: 8px; margin:0; padding:0; width: '+(maximum*8)+'px;';
    var img_alt=score+' '+_traduction.sur[_langue]+' '+maximum;
    var html='<div style="'+div_style+'"><img src="'+img_src+'" alt="'+img_alt+'" title="'+img_alt+'" style="'+img_style+'" /></div>';
    return html
};

function image_css_heros(id_image,faction,visage){
    var id_faction=_factions[faction].nom['en'].toUpperCase();
    var x=(visage-1)*-71;
    var css_background='url('+_base_url+'images/Hero_'+id_faction+'_2.jpg) no-repeat '+x+'px center';
    $('#'+id_image).css('background',css_background);
    $('#'+id_image).attr('alt','portrait numÃ©ro '+visage+' de la faction '+_factions[faction].nom[_langue])
};

function image_css_archetype(id_image,archetype){
    var type=_archetypes[archetype].type;
    $('#'+id_image).css('background','url('+_base_url+'images/bandeau-'+type+'.png) no-repeat left 65px')
};

function image_css_artefact_old(id_image,artefact){
    if(artefact===undefined){
        $('#'+id_image).css('background-image','none');
        return true
    }
    var icone=_artefacts[artefact].icone;
    var faction=_artefacts[artefact].faction;
    if(icone===''||faction===''){
        $('#'+id_image).css('background-image','url('+_base_url+'images/artefact-inconnu.png)');
        $('#'+id_image).css('background-repeat','no-repeat');
        $('#'+id_image).css('background-position','0 0');
        return true
    }
    if(faction==-1&&_artefacts[artefact].type==2)faction='HEREDITY';
    else if(faction==-1&&_artefacts[artefact].type==1)faction='REWARD';
    else if(faction==-1)faction='COMMON';else faction=_factions[faction].nom['en'].toUpperCase();
    if(faction=='COMMON'&&icone>14){
        var x=(icone-15)*-37;
        var y=-36
    }else{
        var x=(icone-1)*-37;
        var y=0
    }
    $('#'+id_image).css('background-image','url('+_base_url+'images/Artefact_'+faction+'.png)');
    $('#'+id_image).css('background-repeat','no-repeat');
    $('#'+id_image).css('background-position',x+'px '+y+'px')
};

function image_css_artefact(id_image,artefact){
    if(artefact===undefined){
        $('#'+id_image).css('background-image','none');
        return true
    }
    var icone=_artefacts[artefact].icone;
    var faction=_artefacts[artefact].faction;
    if(icone===''||faction===''){
        $('#'+id_image).css('background-image','url('+_base_url+'images/artefact-inconnu.png)');
        $('#'+id_image).css('background-repeat','no-repeat');
        $('#'+id_image).css('background-position','0 0');
        return true
    }
    if(faction==-1&&_artefacts[artefact].type==2)var planche='HEREDITY';
    else if(faction==-1&&_artefacts[artefact].type==1)var planche='REWARD';
    else if(_artefacts[artefact].set!==undefined)var planche='SET';else var planche='COMMON';
    if(planche=='COMMON'){
        if(faction==-1){
            if(icone>14){
                var dx=icone-15;
                var dy=1
            }else{
                var dx=icone-1;
                var dy=0
            }
        }else if(icone>0){
            var ddy=1+((faction+1)*7);
            if(icone>8){
                var dx=icone-9;
                var dy=ddy
            }else{
                var dx=icone-1;
                var dy=ddy-1
            }
        }else{
            var slot=_artefacts[artefact].slot;
            var dx=_slots[slot].icone-1;
            var niv=(_artefacts[artefact].niv) ? (_artefacts[artefact].niv-1) : (artefact-143)%5;
            var dy=2+(faction*7)+niv
        }
        var x=dx*-40;
        var y=dy*-40
    }else if(planche=='SET'){
        var dx=(icone-1)%11;
        var dy=Math.floor((icone-1)/11);
        var x=dx*-36;
        var y=dy*-36
    }else{
        var x=(icone-1)*-37;
        var y=0
    }
    $('#'+id_image).css('background-image','url('+_base_url+'images/Artefact_'+planche+'.png)');
    $('#'+id_image).css('background-repeat','no-repeat');
    $('#'+id_image).css('background-position',x+'px '+y+'px')
};

function image_css_slot(id_image,slot){
    if(slot===undefined)return false;
    if(slot>3){
        var x=((slot-4)*-45)-8;
        var y=-54
    }else{
        var x=(slot*-45)-8;
        var y=-6
    }
    $('#'+id_image).css('background-image','url('+_base_url+'images/emplacements-artefacts.png)');
    $('#'+id_image).css('background-repeat','no-repeat');
    $('#'+id_image).css('background-position',x+'px '+y+'px')
};

function image_html_artefact_equipe(){
    return'<img src="'+_base_url+'images/equipe.png" style="border:none;width:37px;height:36px;" />'
};

function image_css_carriere(id_image,carriere){
    if(carriere===undefined){
        $('#'+id_image).css('background-image','url()');
        $('#'+id_image).css('display','none');
        return true
    }
    var x=(_carrieres[carriere].icone-1)*-44;
    $('#'+id_image).css('display','block');
    $('#'+id_image).css('background','url('+_base_url+'images/HeroClass.png) no-repeat '+x+'px 0px')
};

function image_css_carriere_type(id_image,carriere){
    if(carriere===undefined){
        $('#'+id_image).css('background-image','url('+_base_url+'images/hero-other.jpg)');
        return true
    }
    if(inArray([0,2,9,12],carriere))var couleur='green';
    else if(inArray([4,6,7,8],carriere))var couleur='purple';else var couleur='red';
    $('#'+id_image).css('background-image','url('+_base_url+'images/hero-'+couleur+'.jpg)')
};

function image_css_talent(id_image,carriere,talent){
    if(carriere===undefined||talent===undefined){
        return $('#'+id_image).css('background-image','none')
    }
    var icone=_talents[carriere][talent].icone;
    var x=((icone-1)%10)*-25;
    var y=Math.floor((icone-1)/10)*-25;
    if(icone==51){
        x=-250;
        y=-100
    }
    $('#'+id_image).css('background-image','url('+_base_url+'images/HeroClassSkill.png)');
    $('#'+id_image).css('background-repeat','no-repeat');
    $('#'+id_image).css('background-position',x+'px '+y+'px')
};

function image_css_hereditaire(id_image, hereditaire, small){
    
    function get_coords(name) {
        switch(name){
            case 'Battle Spoils': return {'x': 150, 'y': 300};
            case 'Raise the Dead': return {'x': 0, 'y': 75};
            case 'Magic Resistance': return {'x': 0, 'y': 0};
            case 'Morale High': return {'x': 75, 'y': 75};
            case 'Resurrection': return {'x': 75, 'y': 0};
            case 'Barrage Fire': return {'x': 150, 'y': 75};
            case 'Tougher Hero': return {'x': 75, 'y': 150};
            case 'Spell Mastery': return {'x': 150, 'y': 150};
            case 'Characteristics Illumination': return {'x': 150, 'y': 225};
            case 'Talented Hero': return {'x': 75, 'y': 225};
            case 'Skill Revelation': return {'x': 0, 'y': 225};
            case 'Population Contribution': return {'x': 0, 'y': 300};
            case 'Personal Wealth': return {'x': 75, 'y': 300};
            case 'Daily Recruitment': return {'x': 150, 'y': 0};
            case 'Mysticism': return {'x': 0, 'y': 150};
            default: return {'x': 0, 'y': 0};
        }
    }
    
    var coords = get_coords(hereditaire.nom['en']);
    var img = 'BonusIcon_HEREDITY' + (small ? '_d5x3' : '');
    var mod = small ? 3/5 : 1;
    $('#'+id_image).css('width',(75*mod)+'px'); 
    $('#'+id_image).css('height',(75*mod)+'px'); 
    $('#'+id_image).css('background-image','url('+_base_url+'images/' + img + '.png)');
    $('#'+id_image).css('background-repeat','no-repeat');
    $('#'+id_image).css('background-position','-'+(coords.x*mod)+'px -'+(coords.y*mod)+'px');
}

function image_html_ressource(ressource){
    var nom=_ressources[ressource].nom[_langue];
    var icone=_ressources[ressource].icone;
    var x=(icone-1)*-20-((icone>1)?1:0);
    var y=-1;
    var html='<img src="'+_base_url+'images/unite.png"';
    html+=' width="18px" height="18px"';
    html+=' alt="'+nom+'" title="'+nom+'"';
    html+=' style="background: url('+_base_url+'images/Ressources.png) no-repeat '+x+'px '+y+'px"';
    html+=' />';
    return html
};

function image_html_plus_moins(signe,quantite,id){
    var q=formate_zeros(quantite,3,true);
    var qnf=(quantite==1)?'un':((quantite==10)?'dix':'cent');
    var snf=(signe=='p')?'plus':'moins';
    var qn=(quantite==1)?_traduction.un[_langue]:((quantite==10)?_traduction.dix[_langue]:_traduction.cent[_langue]);
    var sn=(signe=='p')?_traduction.plus[_langue]:_traduction.moins[_langue];
    var html='<img src="'+_base_url+'images/'+snf+'-'+qnf+'.png"';
    html+=' id="'+signe+q+'-'+id+'"';
    html+=' class="plus-moins"';
    html+=' width="11px" height="22px"';
    html+=' alt="'+sn+' '+qn+'" title="'+sn+' '+qn+'" />';
    return html
};

function modifie_image_plus_moins(id,survol){
    var s=(id.substr(0,1)=='p')?'plus':'moins';
    var q=(id.substr(1,3)=='001')?'un':((id.substr(1,3)=='010')?'dix':'cent');
    if(survol)return $('img#'+id).attr('src',_base_url+'images/'+s+'-survol.png');
    if(!survol)return $('img#'+id).attr('src',_base_url+'images/'+s+'-'+q+'.png')
};

function image_html_fleche(dir,camp,peloton){
    if(dir=='h')direction='haut';else direction='bas';
    var html='<img src="'+_base_url+'images/fleche-'+direction+'.png"';
    html+=' id="fleche-'+dir+'-'+peloton+'-'+camp+'"';
    html+=' class="fleche"';
    html+=' alt="'+_traduction[direction][_langue]+'" title="'+_traduction[direction][_langue]+'" />';
    return html
};

function modifie_image_fleche(id,survol){
    var d=(id.substr(7,1)=='h')?'haut':'bas';
    if(survol)return $('img#'+id).attr('src',_base_url+'images/fleche-'+d+'-survol.png');
    if(!survol)return $('img#'+id).attr('src',_base_url+'images/fleche-'+d+'.png')
};

function image_html_croix(camp,peloton){
    var html='<img src="'+_base_url+'images/croix.png"';
    html+=' id="croix-'+peloton+'-'+camp+'"';
    html+=' class="croix"';
    html+=' alt="'+_traduction.supprimer[_langue]+'" title="'+_traduction.supprimer[_langue]+'" />';
    return html
};

function modifie_image_croix(id,survol){
    if(survol)return $('img#'+id).attr('src',_base_url+'images/croix-survol.png');
    if(!survol)return $('img#'+id).attr('src',_base_url+'images/croix.png')
};