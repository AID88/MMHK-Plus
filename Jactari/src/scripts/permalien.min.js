/* 
	Created by Jactari
	Updated by Aspirin and Aendawyn
	Maintained by Aendawyn

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.
	
	You should have received a copy of the GNU General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
	
*/

var _base64='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';
var _base_arte={
    81:10,
    106:16,
    79:20,
    91:24,
    93:25,
    82:27,
    101:30,
    115:31,
    87:33,
    97:35,
    86:43,
    99:44,
    89:46,
    94:47,
    96:48,
    85:49,
    104:50,
    98:51,
    92:54,
    100:59,
    107:61,
    114:62,
    103:63,
    83:64,
    116:65,
    95:66,
    108:67,
    105:68,
    88:69,
    113:79,
    112:81,
    117:82,
    90:83,
    111:85,
    110:86,
    102:87,
    119:93,
    118:94,
    121:95,
    120:96,
    109:53,
    10:8
};

function encode_donnees_combat(donnees){
    var triplets=[];
    var version=5;
    triplets[0]|=(version&63)<<18;
    triplets[0]|=(donnees.d.lieu&3)<<16;
    triplets[0]|=(donnees.a.statut&1)<<15;
    triplets[0]|=(donnees.a.heros&1)<<14;
    triplets[0]|=(donnees.a.cri_de_guerre&3)<<12;
    triplets[0]|=(donnees.a.inspiration&3)<<10;
    triplets[0]|=(donnees.a.dolmens&15)<<6;
    triplets[0]|=(donnees.a.niveau&63);
    triplets[1]|=(donnees.a.artefacts[0]&2047)<<13;
    triplets[1]|=(donnees.a.tacticien&3)<<11;
    triplets[1]|=(donnees.a.artefacts[1]&2047);
    triplets[2]|=(donnees.a.artefacts[2]&2047)<<13;
    triplets[2]|=(donnees.a.ecuyer&3)<<11;
    triplets[2]|=(donnees.a.artefacts[3]&2047);
    triplets[3]|=(donnees.a.artefacts[4]&2047)<<13;
    triplets[3]|=(donnees.a.tireur_elite&3)<<11;
    triplets[3]|=(donnees.a.artefacts[5]&2047);
    triplets[4]|=(donnees.a.artefacts[6]&2047)<<13;
    triplets[4]|=(donnees.a.commandant_infanterie&3)<<11;
    triplets[4]|=(donnees.a.artefacts[7]&2047);
    triplets[5]|=(donnees.a.logisticien&3)<<22;
    triplets[5]|=(donnees.a.harangueur&3)<<20;
    triplets[5]|=(donnees.a.sapeur&3)<<18;
    triplets[5]|=(donnees.a.massacreur&3)<<16;
    triplets[5]|=(donnees.a.instinct[0]&3)<<14;
    triplets[5]|=(donnees.a.expert[0]&3)<<12;
    triplets[5]|=(donnees.a.instinct[1]&3)<<10;
    triplets[5]|=(donnees.a.expert[1]&3)<<8;
    triplets[5]|=(donnees.a.instinct[2]&3)<<6;
    triplets[5]|=(donnees.a.expert[2]&3)<<4;
    triplets[5]|=(donnees.a.instinct[3]&3)<<2;
    triplets[5]|=(donnees.a.expert[3]&3);
    triplets[6]|=(donnees.a.bonus_ecole[0]&15)<<20;
    triplets[6]|=(donnees.a.bonus_ecole[1]&15)<<16;
    triplets[6]|=(donnees.a.bonus_ecole[2]&15)<<12;
    triplets[6]|=(donnees.a.bonus_ecole[3]&15)<<8;
    triplets[6]|=(donnees.a.larmes&31)<<3;
    triplets[6]|=(donnees.a.faction&7);
    triplets[7]|=(donnees.a.mhr.signe&1)<<23;
    triplets[7]|=(donnees.a.mhr.valeur&131071)<<6;
    triplets[7]|=(donnees.a.archetype&15)<<2;
    triplets[7]|=(donnees.a.arcanes&3);
    triplets[8]|=(donnees.d.mhr.signe&1)<<23;
    triplets[8]|=(donnees.d.mhr.valeur&131071)<<6;
    triplets[8]|=(donnees.d.larmes&31)<<1;
    triplets[9]|=(donnees.d.statut&1)<<23;
    triplets[9]|=(donnees.d.heros&1)<<22;
    triplets[9]|=(donnees.d.fortification&3)<<20;
    triplets[9]|=(donnees.d.dolmens&15)<<16;
    triplets[9]|=(donnees.d.forts&7)<<13;
    triplets[9]|=(donnees.d.fort_principal&1)<<12;
    triplets[9]|=(donnees.d.ralliement&3)<<10;
    triplets[9]|=(donnees.d.inspiration&3)<<8;
    triplets[9]|=(donnees.d.archetype&15)<<4;
    triplets[9]|=(donnees.d.faction&7)<<1;
    triplets[10]|=(donnees.d.bonus_ecole[0]&15)<<20;
    triplets[10]|=(donnees.d.bonus_ecole[1]&15)<<16;
    triplets[10]|=(donnees.d.bonus_ecole[2]&15)<<12;
    triplets[10]|=(donnees.d.bonus_ecole[3]&15)<<8;
    triplets[10]|=(donnees.d.arcanes&3)<<6;
    triplets[10]|=(donnees.d.niveau&63);
    triplets[11]|=(donnees.d.artefacts[0]&2047)<<13;
    triplets[11]|=(donnees.d.tacticien_defenseur&3)<<11;
    triplets[11]|=(donnees.d.artefacts[1]&2047);
    triplets[12]|=(donnees.d.artefacts[2]&2047)<<13;
    triplets[12]|=(donnees.d.ecuyer_defenseur&3)<<11;
    triplets[12]|=(donnees.d.artefacts[3]&2047);
    triplets[13]|=(donnees.d.artefacts[4]&2047)<<13;
    triplets[13]|=(donnees.d.expert_tirs_barrage&3)<<11;
    triplets[13]|=(donnees.d.artefacts[5]&2047);
    triplets[14]|=(donnees.d.artefacts[6]&2047)<<13;
    triplets[14]|=(donnees.d.inebranlable&3)<<11;
    triplets[14]|=(donnees.d.artefacts[7]&2047);
    triplets[15]|=(donnees.d.logisticien&3)<<22;
    triplets[15]|=(donnees.d.bon_payeur&3)<<20;
    triplets[15]|=(donnees.d.batisseur_fortifications&3)<<18;
    triplets[15]|=(donnees.d.massacreur&3)<<16;
    triplets[15]|=(donnees.d.instinct[0]&3)<<14;
    triplets[15]|=(donnees.d.expert[0]&3)<<12;
    triplets[15]|=(donnees.d.instinct[1]&3)<<10;
    triplets[15]|=(donnees.d.expert[1]&3)<<8;
    triplets[15]|=(donnees.d.instinct[2]&3)<<6;
    triplets[15]|=(donnees.d.expert[2]&3)<<4;
    triplets[15]|=(donnees.d.instinct[3]&3)<<2;
    triplets[15]|=(donnees.d.expert[3]&3);
    for(var c in _camps){
        for(var p=1;p<8;p++){
            var u=donnees[_camps_abr[c]].troupes[p].unite;
            if(u==-1)u=255;
            triplets[15+p+(c*7)]|=(u&255)<<16;
            triplets[15+p+(c*7)]|=(donnees[_camps_abr[c]].troupes[p].nombre&65535)
        }
    }
    triplets[30]|=(donnees.a.sort[0].id&63)<<18;
    triplets[30]|=(donnees.a.sort[0].tour&15)<<14;
    triplets[30]|=(donnees.a.sort[1].id&63)<<6;
    triplets[30]|=(donnees.a.sort[1].tour&15)<<2;
    triplets[30]|=(donnees.saison&12) >> 2;
    triplets[31]|=(donnees.d.sort[0].id&63)<<18;
    triplets[31]|=(donnees.d.sort[0].tour&15)<<14;
    triplets[31]|=(donnees.d.sort[1].id&63)<<6;
    triplets[31]|=(donnees.d.sort[1].tour&15)<<2;
    triplets[31]|=(donnees.saison&3);
    triplets[32]|=(donnees.a.butin_de_guerre&15)<<20;
    triplets[32]|=(donnees.a.relever_les_morts&15)<<16;
    triplets[32]|=(donnees.a.resistance_magique&15)<<12;
    triplets[32]|=(donnees.a.moral_eleve&15)<<8;
    triplets[32]|=(donnees.a.resurrection&15)<<4;
    triplets[32]|=(donnees.a.tir_de_barrage&15);
    triplets[33]|=(donnees.a.heros_superieur&15)<<20;
    triplets[33]|=(donnees.a.maitrise_des_sorts&15)<<16;
    triplets[33]|=(donnees.a.revelation_de_caracteristiques&15)<<12;
    triplets[33]|=(donnees.d.butin_de_guerre&15)<<8;
    triplets[33]|=(donnees.d.relever_les_morts&15)<<4;
    triplets[33]|=(donnees.d.resistance_magique&15);
    
    triplets[34]|=(donnees.d.moral_eleve&15)<<20;
    triplets[34]|=(donnees.d.resurrection&15)<<16;
    triplets[34]|=(donnees.d.tir_de_barrage&15)<<12;
    triplets[34]|=(donnees.d.heros_superieur&15)<<8;
    triplets[34]|=(donnees.d.maitrise_des_sorts&15)<<4;
    triplets[34]|=(donnees.d.revelation_de_caracteristiques&15);
    
    triplets[35]|=(donnees.a.classement_voies&7)<<21; // D > W > H
    triplets[35]|=(donnees.d.classement_voies&7)<<18; // D > W > H
    triplets[35]|=(donnees.a.malus_attaque&63)<<12; // attack malus
    if(donnees.a.statut==0){
        triplets[35]|=(donnees.a.antimagie&15)<<8;
        triplets[35]|=(donnees.a.baliste&15)<<4;
        triplets[35]|=(donnees.a.pieges&15)
    }
    
    if(donnees.d.statut==0){
        triplets[35]|=(donnees.d.antimagie&15)<<8;
        triplets[35]|=(donnees.d.baliste&15)<<4;
        triplets[35]|=(donnees.d.pieges&15)
    }

    triplets[36]|=(donnees.a.legendary_sovereign_a&3)<<21;
    triplets[36]|=(donnees.a.legendary_sovereign_b&3)<<18;
    triplets[36]|=(donnees.a.legendary_sovereign_c&3)<<15;
    triplets[36]|=(donnees.a.legendary_legwarrior_a&3)<<12;
    triplets[36]|=(donnees.a.legendary_legwarrior_b&3)<<9;
    triplets[36]|=(donnees.a.legendary_legwarrior_c&3)<<6;
    triplets[36]|=(donnees.a.legendary_magehunter_a&3)<<3;
    triplets[36]|=(donnees.a.legendary_magehunter_b&3);

    triplets[37]|=(donnees.a.legendary_magehunter_c&3)<<21;
    triplets[37]|=(donnees.a.legendary_legpaladin_a&3)<<18;
    triplets[37]|=(donnees.a.legendary_legpaladin_b&3)<<15;
    triplets[37]|=(donnees.a.legendary_legpaladin_c&3)<<12;
    triplets[37]|=(donnees.a.legendary_ethernalnight_a&3)<<9;
    triplets[37]|=(donnees.a.legendary_ethernalnight_b&3)<<6;
    triplets[37]|=(donnees.a.legendary_ethernalnight_c&3)<<3;
    triplets[37]|=(donnees.a.legendary_kingundead_a&3);

    triplets[38]|=(donnees.a.legendary_kingundead_b&3)<<21;
    triplets[38]|=(donnees.a.legendary_kingundead_c&3)<<18;
    triplets[38]|=(donnees.a.legendary_legmagician_a&3)<<15;
    triplets[38]|=(donnees.a.legendary_legmagician_b&3)<<12;
    triplets[38]|=(donnees.a.legendary_legmagician_c&3)<<9;
    triplets[38]|=(donnees.a.legendary_dragonkinght_a&3)<<6;
    triplets[38]|=(donnees.a.legendary_dragonkinght_b&3)<<3;
    triplets[38]|=(donnees.a.legendary_dragonkinght_c&3);

    triplets[39]|=(donnees.d.legendary_sovereign_a&3)<<21;
    triplets[39]|=(donnees.d.legendary_sovereign_b&3)<<18;
    triplets[39]|=(donnees.d.legendary_sovereign_c&3)<<15;
    triplets[39]|=(donnees.d.legendary_legwarrior_a&3)<<12;
    triplets[39]|=(donnees.d.legendary_legwarrior_b&3)<<9;
    triplets[39]|=(donnees.d.legendary_legwarrior_c&3)<<6;
    triplets[39]|=(donnees.d.legendary_magehunter_a&3)<<3;
    triplets[39]|=(donnees.d.legendary_magehunter_b&3);

    triplets[40]|=(donnees.d.legendary_magehunter_c&3)<<21;
    triplets[40]|=(donnees.d.legendary_legpaladin_a&3)<<18;
    triplets[40]|=(donnees.d.legendary_legpaladin_b&3)<<15;
    triplets[40]|=(donnees.d.legendary_legpaladin_c&3)<<12;
    triplets[40]|=(donnees.d.legendary_ethernalnight_a&3)<<9;
    triplets[40]|=(donnees.d.legendary_ethernalnight_b&3)<<6;
    triplets[40]|=(donnees.d.legendary_ethernalnight_c&3)<<3;
    triplets[40]|=(donnees.d.legendary_kingundead_a&3);

    triplets[41]|=(donnees.d.legendary_kingundead_b&3)<<21;
    triplets[41]|=(donnees.d.legendary_kingundead_c&3)<<18;
    triplets[41]|=(donnees.d.legendary_legmagician_a&3)<<15;
    triplets[41]|=(donnees.d.legendary_legmagician_b&3)<<12;
    triplets[41]|=(donnees.d.legendary_legmagician_c&3)<<9;
    triplets[41]|=(donnees.d.legendary_dragonkinght_a&3)<<6;
    triplets[41]|=(donnees.d.legendary_dragonkinght_b&3)<<3;
    triplets[41]|=(donnees.d.legendary_dragonkinght_c&3);

    var code='';
    for (var t=0;t<=41;t++) {
        code+=_base64.charAt((triplets[t]>>18)&63);
        code+=_base64.charAt((triplets[t]>>12)&63);
        code+=_base64.charAt((triplets[t]>>6)&63);
        code+=_base64.charAt((triplets[t])&63);
    }
    return code;
}
function decode_donnees_combat(code){
    if(!inArray([112,117,133,134,136,144,168],code.length))return false;
    var reg=/^[A-Za-z0-9_-]{112}|[A-Za-z0-9_-]{117}|[A-Za-z0-9_-]{133,134}|[A-Za-z0-9_-]{136}|[A-Za-z0-9_-]{144}|[A-Za-z0-9_-]{168}$/;
    if(!reg.test(code))return false;
    var triplets=[];
    for(var c=0;c<code.length;c++){
        var i=Math.floor(c/4);
        var d=(3-(c%4))*6;
        triplets[i]|=_base64.indexOf(code.charAt(c))<<d
    }
    var donnees={
        saison:0,
        a:{
            artefacts:[],
            instinct:[],
            expert:[],
            bonus_ecole:[],
            troupes:[],
            sort:[],
            mhr:{
                signe:0,
                valeur:0
            },
            malus_attaque:0
        },
        d:{
            artefacts:[],
            instinct:[],
            expert:[],
            bonus_ecole:[],
            troupes:[],
            sort:[],
            mhr:{
                signe:0,
                valeur:0
            }
        }
    };
    if(code.length<133) {
        donnees.a.statut=(triplets[0]>>23)&1;
        donnees.a.dolmens=(triplets[0]>>19)&15;
        donnees.d.lieu=(triplets[0]>>17)&3;
        var version=(triplets[0]>>15)&3;
        if(version<3&&code.length!=112)return false;
        if(version>=3&&code.length!=117)return false;
        donnees.a.cri_de_guerre=(triplets[0]>>13)&3;
        donnees.a.inspiration=(triplets[0]>>11)&3;
        donnees.a.heros=(triplets[0]>>10)&1;
        donnees.a.niveau=(triplets[0]>>4)&63;
        var version_base_arte=0;
        if(version<2)donnees.a.faction=(triplets[0]>>2)&3;else version_base_arte=(triplets[0]>>2)&1;
        donnees.a.tacticien=(triplets[0])&3;
        donnees.a.artefacts[0]=(triplets[1]>>17)&127;
        donnees.a.artefacts[1]=(triplets[1]>>10)&127;
        donnees.a.archetype=(triplets[1]>>6)&15;
        donnees.a.ecuyer=(triplets[1]>>4)&3;
        donnees.a.tireur_elite=(triplets[1]>>2)&3;
        donnees.a.commandant_infanterie=(triplets[1])&3;
        donnees.a.artefacts[2]=(triplets[2]>>17)&127;
        donnees.a.artefacts[3]=(triplets[2]>>10)&127;
        donnees.a.logisticien=(triplets[2]>>8)&3;
        donnees.a.harangueur=(triplets[2]>>6)&3;
        donnees.a.sapeur=(triplets[2]>>4)&3;
        donnees.a.massacreur=(triplets[2]>>2)&3;
        donnees.a.instinct_0=(triplets[2])&3;
        donnees.a.artefacts[4]=(triplets[3]>>17)&127;
        donnees.a.artefacts[5]=(triplets[3]>>10)&127;
        donnees.a.expert_0=(triplets[3]>>8)&3;
        donnees.a.instinct_1=(triplets[3]>>6)&3;
        donnees.a.expert_1=(triplets[3]>>4)&3;
        donnees.a.instinct_2=(triplets[3]>>2)&3;
        donnees.a.expert_2=(triplets[3])&3;
        donnees.a.artefacts[6]=(triplets[4]>>17)&127;
        donnees.a.artefacts[7]=(triplets[4]>>10)&127;
        donnees.a.instinct_3=(triplets[4]>>8)&3;
        donnees.a.expert_3=(triplets[4]>>6)&3;
        donnees.a.arcanes=(triplets[4]>>4)&3;
        donnees.a.bonus_ecole[0]=(triplets[4])&15;
        donnees.a.bonus_ecole[1]=(triplets[5]>>20)&15;
        donnees.a.bonus_ecole[2]=(triplets[5]>>16)&15;
        donnees.a.bonus_ecole[3]=(triplets[5]>>12)&15;
        donnees.d.bonus_ecole[0]=(triplets[5]>>8)&15;
        donnees.d.bonus_ecole[1]=(triplets[5]>>4)&15;
        donnees.d.bonus_ecole[2]=(triplets[5])&15;
        donnees.d.bonus_ecole[3]=(triplets[6]>>20)&15;
        donnees.d.statut=(triplets[6]>>19)&1;
        donnees.d.heros=(triplets[6]>>18)&1;
        donnees.d.fortification=(triplets[6]>>16)&3;
        donnees.d.dolmens=(triplets[6]>>12)&15;
        donnees.d.forts=(triplets[6]>>9)&7;
        donnees.d.fort_principal=(triplets[6]>>8)&1;
        donnees.d.ralliement=(triplets[6]>>6)&3;
        donnees.d.inspiration=(triplets[6]>>4)&3;
        donnees.d.archetype=(triplets[6])&15;
        donnees.d.niveau=(triplets[7]>>18)&63;
        donnees.d.faction=(triplets[7]>>16)&3;
        donnees.d.artefacts[0]=(triplets[7]>>9)&127;
        donnees.d.artefacts[1]=(triplets[7]>>2)&127;
        donnees.d.tacticien_defenseur=(triplets[7])&3;
        donnees.d.artefacts[2]=(triplets[8]>>17)&127;
        donnees.d.artefacts[3]=(triplets[8]>>10)&127;
        donnees.d.ecuyer_defenseur=(triplets[8]>>8)&3;
        donnees.d.expert_tirs_barrage=(triplets[8]>>6)&3;
        donnees.d.inebranlable=(triplets[8]>>4)&3;
        donnees.d.logisticien=(triplets[8]>>2)&3;
        donnees.d.bon_payeur=(triplets[8])&3;
        donnees.d.artefacts[4]=(triplets[9]>>17)&127;
        donnees.d.artefacts[5]=(triplets[9]>>10)&127;
        donnees.d.batisseur_fortifications=(triplets[9]>>8)&3;
        donnees.d.massacreur=(triplets[9]>>6)&3;
        donnees.d.instinct_0=(triplets[9]>>4)&3;
        donnees.d.expert_0=(triplets[9]>>2)&3;
        donnees.d.instinct_1=(triplets[9])&3;
        donnees.d.artefacts[6]=(triplets[10]>>17)&127;
        donnees.d.artefacts[7]=(triplets[10]>>10)&127;
        donnees.d.expert_1=(triplets[10]>>8)&3;
        donnees.d.instinct_2=(triplets[10]>>6)&3;
        donnees.d.expert_2=(triplets[10]>>4)&3;
        donnees.d.instinct_3=(triplets[10]>>2)&3;
        donnees.d.expert_3=(triplets[10])&3;
        donnees.d.arcanes=(triplets[11]>>22)&3;
        donnees.a.larmes=(triplets[11]>>17)&31;
        donnees.d.larmes=(triplets[11]>>12)&31;
        if(version>=2)donnees.a.faction=(triplets[11]>>9)&7;
        if(version>=2)donnees.d.faction=(triplets[11]>>6)&7;
        if(version>=3)donnees.a.mhr.signe=(triplets[11]>>5)&1;
        if(version>=3)donnees.a.mhr.valeur=(triplets[11]&31)<<12;
        for(var c in _camps){
            for(var p=1;p<8;p++){
                var unite=(triplets[11+p+(c*7)]>>16)&255;
                if(unite==255)unite=-1;
                donnees[_camps_abr[c]].troupes[p]={
                    unite:unite,
                    nombre:((triplets[11+p+(c*7)])&65535)
                }
            }
        }
        if(version==0){
            donnees.a.sort[0]={
                id:((triplets[26]>>18)&63),
                tour:((triplets[26]>>15)&7)
            };

            donnees.a.sort[1]={
                id:((triplets[26]>>9)&63),
                tour:((triplets[26]>>6)&7)
            };

            donnees.d.sort[0]={
                id:((triplets[26])&63),
                tour:((triplets[27]>>21)&7)
            };

            donnees.d.sort[1]={
                id:((triplets[27]>>15)&63),
                tour:((triplets[27]>>12)&7)
            }
        }else if(version>=1){
            donnees.a.sort[0]={
                id:((triplets[26]>>18)&63),
                tour:((triplets[26]>>14)&15)
            };

            donnees.a.sort[1]={
                id:((triplets[26]>>6)&63),
                tour:((triplets[26]>>2)&15)
            };

            donnees.d.sort[0]={
                id:((triplets[27]>>18)&63),
                tour:((triplets[27]>>14)&15)
            };

            donnees.d.sort[1]={
                id:((triplets[27]>>6)&63),
                tour:((triplets[27]>>2)&15)
            }
        }
        if(version>=3)donnees.a.mhr.valeur|=(triplets[28]>>12)&4095;
        if(version>=3)donnees.d.mhr.signe=(triplets[28]>>11)&1;
        if(version>=3)donnees.d.mhr.valeur=(triplets[28]&2047)<<6;
        if(version>=3)donnees.d.mhr.valeur|=(triplets[29]>>18)&63;
        if(version_base_arte==0)for(var a=0;a<8;a++){
            if(_base_arte[donnees.a.artefacts[a]]!==undefined)donnees.a.artefacts[a]=_base_arte[donnees.a.artefacts[a]];
            if(_base_arte[donnees.d.artefacts[a]]!==undefined)donnees.d.artefacts[a]=_base_arte[donnees.d.artefacts[a]]
        }
    } else {
        var version = (triplets[0]>>18)&63;
        donnees.d.lieu=(triplets[0]>>16)&3;
        donnees.a.statut=(triplets[0]>>15)&1;
        donnees.a.heros=(triplets[0]>>14)&1;
        donnees.a.cri_de_guerre=(triplets[0]>>12)&3;
        donnees.a.inspiration=(triplets[0]>>10)&3;
        donnees.a.dolmens=(triplets[0]>>6)&15;
        donnees.a.niveau=(triplets[0])&63;
        if (version > 4) {
            donnees.a.artefacts[0]=(triplets[1]>>13)&2047;
            donnees.a.tacticien=(triplets[1]>>11)&3;
            donnees.a.artefacts[1]=(triplets[1])&2047;
            donnees.a.artefacts[2]=(triplets[2]>>13)&2047;
            donnees.a.ecuyer=(triplets[2]>>11)&3;
            donnees.a.artefacts[3]=(triplets[2])&2047;
            donnees.a.artefacts[4]=(triplets[3]>>13)&2047;
            donnees.a.tireur_elite=(triplets[3]>>11)&3;
            donnees.a.artefacts[5]=(triplets[3])&2047;
            donnees.a.artefacts[6]=(triplets[4]>>13)&2047;
            donnees.a.commandant_infanterie=(triplets[4]>>11)&3;
            donnees.a.artefacts[7]=(triplets[4])&2047;
            donnees.a.logisticien=(triplets[5]>>22)&3;
            donnees.a.harangueur=(triplets[5]>>20)&3;
            donnees.a.sapeur=(triplets[5]>>18)&3;
            donnees.a.massacreur=(triplets[5]>>16)&3;
            donnees.a.instinct_0=(triplets[5]>>14)&3;
            donnees.a.expert_0=(triplets[5]>>12)&3;
            donnees.a.instinct_1=(triplets[5]>>10)&3;
            donnees.a.expert_1=(triplets[5]>>8)&3;
            donnees.a.instinct_2=(triplets[5]>>6)&3;
            donnees.a.expert_2=(triplets[5]>>4)&3;
            donnees.a.instinct_3=(triplets[5]>>2)&3;
            donnees.a.expert_3=(triplets[5])&3;
            var t = 6
        } else {
            donnees.a.artefacts[0]=(triplets[1]>>16)&255;
            donnees.a.artefacts[1]=(triplets[1]>>8)&255;
            donnees.a.tacticien=(triplets[1]>>6)&3;
            donnees.a.ecuyer=(triplets[1]>>4)&3;
            donnees.a.tireur_elite=(triplets[1]>>2)&3;
            donnees.a.commandant_infanterie=(triplets[1])&3;
            donnees.a.artefacts[2]=(triplets[2]>>16)&255;
            donnees.a.artefacts[3]=(triplets[2]>>8)&255;
            donnees.a.logisticien=(triplets[2]>>6)&3;
            donnees.a.harangueur=(triplets[2]>>4)&3;
            donnees.a.sapeur=(triplets[2]>>2)&3;
            donnees.a.massacreur=(triplets[2])&3;
            donnees.a.artefacts[4]=(triplets[3]>>16)&255;
            donnees.a.artefacts[5]=(triplets[3]>>8)&255;
            donnees.a.instinct_0=(triplets[3]>>6)&3;
            donnees.a.expert_0=(triplets[3]>>4)&3;
            donnees.a.instinct_1=(triplets[3]>>2)&3;
            donnees.a.expert_1=(triplets[3])&3;
            donnees.a.artefacts[6]=(triplets[4]>>16)&255;
            donnees.a.artefacts[7]=(triplets[4]>>8)&255;
            donnees.a.instinct_2=(triplets[4]>>6)&3;
            donnees.a.expert_2=(triplets[4]>>4)&3;
            donnees.a.instinct_3=(triplets[4]>>2)&3;
            donnees.a.expert_3=(triplets[4])&3;
            var t=5
        }
        donnees.a.bonus_ecole[0]=(triplets[t]>>20)&15;
        donnees.a.bonus_ecole[1]=(triplets[t]>>16)&15;
        donnees.a.bonus_ecole[2]=(triplets[t]>>12)&15;
        donnees.a.bonus_ecole[3]=(triplets[t]>>8)&15;
        donnees.a.larmes=(triplets[t]>>3)&31;
        donnees.a.faction=(triplets[t++])&7;
        donnees.a.mhr.signe=(triplets[t]>>23)&1;
        donnees.a.mhr.valeur=(triplets[t]>>6)&131071;
        donnees.a.archetype=(triplets[t]>>2)&15;
        donnees.a.arcanes=(triplets[t++])&3;
        donnees.d.mhr.signe=(triplets[t]>>23)&1;
        donnees.d.mhr.valeur=(triplets[t]>>6)&131071;
        donnees.d.larmes=(triplets[t]>>1)&31;
        if(version==4)donnees.saison=((triplets[t])&1)+1;
        t++;
        donnees.d.statut=(triplets[t]>>23)&1;
        donnees.d.heros=(triplets[t]>>22)&1;
        donnees.d.fortification=(triplets[t]>>20)&3;
        donnees.d.dolmens=(triplets[t]>>16)&15;
        donnees.d.forts=(triplets[t]>>13)&7;
        donnees.d.fort_principal=(triplets[t]>>12)&1;
        donnees.d.ralliement=(triplets[t]>>10)&3;
        donnees.d.inspiration=(triplets[t]>>8)&3;
        donnees.d.archetype=(triplets[t]>>4)&15;
        donnees.d.faction=(triplets[t++]>>1)&7;
        donnees.d.bonus_ecole[0]=(triplets[t]>>20)&15;
        donnees.d.bonus_ecole[1]=(triplets[t]>>16)&15;
        donnees.d.bonus_ecole[2]=(triplets[t]>>12)&15;
        donnees.d.bonus_ecole[3]=(triplets[t]>>8)&15;
        donnees.d.arcanes=(triplets[t]>>6)&3;
        donnees.d.niveau=(triplets[t++])&63;
        if (version > 4) {
            donnees.d.artefacts[0]=(triplets[t]>>13)&2047;
            donnees.d.tacticien_defenseur=(triplets[t]>>11)&3;
            donnees.d.artefacts[1]=(triplets[t++])&2047;
            donnees.d.artefacts[2]=(triplets[t]>>13)&2047;
            donnees.d.ecuyer_defenseur=(triplets[t]>>11)&3;
            donnees.d.artefacts[3]=(triplets[t++])&2047;
            donnees.d.artefacts[4]=(triplets[t]>>13)&2047;
            donnees.d.expert_tirs_barrage=(triplets[t]>>11)&3;
            donnees.d.artefacts[5]=(triplets[t++])&2047;
            donnees.d.artefacts[6]=(triplets[t]>>13)&2047;
            donnees.d.inebranlable=(triplets[t]>>11)&3;
            donnees.d.artefacts[7]=(triplets[t++])&2047;
            donnees.d.logisticien=(triplets[t]>>22)&3;
            donnees.d.bon_payeur=(triplets[t]>>20)&3;
            donnees.d.batisseur_fortifications=(triplets[t]>>18)&3;
            donnees.d.massacreur=(triplets[t]>>16)&3;
            donnees.d.instinct_0=(triplets[t]>>14)&3;
            donnees.d.expert_0=(triplets[t]>>12)&3;
            donnees.d.instinct_1=(triplets[t]>>10)&3;
            donnees.d.expert_1=(triplets[t]>>8)&3;
            donnees.d.instinct_2=(triplets[t]>>6)&3;
            donnees.d.expert_2=(triplets[t]>>4)&3;
            donnees.d.instinct_3=(triplets[t]>>2)&3;
            donnees.d.expert_3=(triplets[t++])&3
        }else{
            donnees.d.artefacts[0]=(triplets[t]>>16)&255;
            donnees.d.artefacts[1]=(triplets[t]>>8)&255;
            donnees.d.tacticien_defenseur=(triplets[t]>>6)&3;
            donnees.d.ecuyer_defenseur=(triplets[t]>>4)&3;
            donnees.d.expert_tirs_barrage=(triplets[t]>>2)&3;
            donnees.d.inebranlable=(triplets[t++])&3;
            donnees.d.artefacts[2]=(triplets[t]>>16)&255;
            donnees.d.artefacts[3]=(triplets[t]>>8)&255;
            donnees.d.logisticien=(triplets[t]>>6)&3;
            donnees.d.bon_payeur=(triplets[t]>>4)&3;
            donnees.d.batisseur_fortifications=(triplets[t]>>2)&3;
            donnees.d.massacreur=(triplets[t++])&3;
            donnees.d.artefacts[4]=(triplets[t]>>16)&255;
            donnees.d.artefacts[5]=(triplets[t]>>8)&255;
            donnees.d.instinct_0=(triplets[t]>>6)&3;
            donnees.d.expert_0=(triplets[t]>>4)&3;
            donnees.d.instinct_1=(triplets[t]>>2)&3;
            donnees.d.expert_1=(triplets[t++])&3;
            donnees.d.artefacts[6]=(triplets[t]>>16)&255;
            donnees.d.artefacts[7]=(triplets[t]>>8)&255;
            donnees.d.instinct_2=(triplets[t]>>6)&3;
            donnees.d.expert_2=(triplets[t]>>4)&3;
            donnees.d.instinct_3=(triplets[t]>>2)&3;
            donnees.d.expert_3=(triplets[t++])&3
        }
        for(var c in _camps){
            for(var p=1;p<8;p++){
                var unite=(triplets[t-1+p+(c*7)]>>16)&255;
                if(unite==255)unite=-1;
                donnees[_camps_abr[c]].troupes[p]={
                    unite:unite,
                    nombre:((triplets[t-1+p+(c*7)])&65535)
                }
            }
        }
        t+=14;
        donnees.a.sort[0]={
            id:((triplets[t]>>18)&63),
            tour:((triplets[t]>>14)&15)
        };

        donnees.a.sort[1]={
            id:((triplets[t]>>6)&63),
            tour:((triplets[t]>>2)&15)
        };

        donnees.d.sort[0]={
            id:((triplets[t+1]>>18)&63),
            tour:((triplets[t+1]>>14)&15)
        };

        donnees.d.sort[1]={
            id:((triplets[t+1]>>6)&63),
            tour:((triplets[t+1]>>2)&15)
        };

        if(version==4){
            donnees.a.malus_attaque=((triplets[t]>>12)&3)<<2;
            donnees.a.malus_attaque|=(triplets[t]&3);
            donnees.a.malus_attaque*=10
        }else{
            donnees.saison=((triplets[t])&3) << 2;
            donnees.saison|=(triplets[t+1])&3
        }
        t+=2;
        donnees.a.butin_de_guerre=(triplets[t]>>20)&15;
        donnees.a.relever_les_morts=(triplets[t]>>16)&15;
        donnees.a.resistance_magique=(triplets[t]>>12)&15;
        donnees.a.moral_eleve=(triplets[t]>>8)&15;
        donnees.a.resurrection=(triplets[t]>>4)&15;
        donnees.a.tir_de_barrage=(triplets[t++])&15;
        donnees.a.heros_superieur=(triplets[t]>>20)&15;
        donnees.a.maitrise_des_sorts=(triplets[t]>>16)&15;
        donnees.a.revelation_de_caracteristiques=(triplets[t]>>12)&15;
        donnees.d.butin_de_guerre=(triplets[t]>>8)&15;
        donnees.d.relever_les_morts=(triplets[t]>>4)&15;
        donnees.d.resistance_magique=(triplets[t++])&15;
        donnees.d.moral_eleve=(triplets[t]>>20)&15;
        donnees.d.resurrection=(triplets[t]>>16)&15;
        donnees.d.tir_de_barrage=(triplets[t]>>12)&15;
        donnees.d.heros_superieur=(triplets[t]>>8)&15;
        donnees.d.maitrise_des_sorts=(triplets[t]>>4)&15;
        donnees.d.revelation_de_caracteristiques=(triplets[t++])&15;
        donnees.a.classement_voies=(triplets[t]>>21)&7;
        donnees.d.classement_voies=(triplets[t]>>18)&7;
        if(donnees.a.malus_attaque==0)donnees.a.malus_attaque|=(triplets[t]>>12)&63;
        if(donnees.a.statut==0&&donnees.d.statut==1){
            donnees.a.antimagie=(triplets[t]>>8)&15;
            donnees.a.baliste=(triplets[t]>>4)&15;
            donnees.a.pieges=(triplets[t])&15
        }else if(donnees.d.statut==0){
            donnees.d.antimagie=(triplets[t]>>8)&15;
            donnees.d.baliste=(triplets[t]>>4)&15;
            donnees.d.pieges=(triplets[t])&15
        }
        // legendary classes and skills
        donnees.a.legendary_sovereign_a = (triplets[36]>>21)&3;
        donnees.a.legendary_sovereign_b = (triplets[36]>>18)&3;
        donnees.a.legendary_sovereign_c = (triplets[36]>>15)&3;
        donnees.a.legendary_legwarrior_a = (triplets[36]>>12)&3;
        donnees.a.legendary_legwarrior_b = (triplets[36]>>9)&3;
        donnees.a.legendary_legwarrior_c = (triplets[36]>>6)&3;
        donnees.a.legendary_magehunter_a = (triplets[36]>>3)&3;
        donnees.a.legendary_magehunter_b = (triplets[36])&3;

        donnees.a.legendary_magehunter_c = (triplets[37]>>21)&3;
        donnees.a.legendary_legpaladin_a = (triplets[37]>>18)&3;
        donnees.a.legendary_legpaladin_b = (triplets[37]>>15)&3;
        donnees.a.legendary_legpaladin_c = (triplets[37]>>12)&3;
        donnees.a.legendary_ethernalnight_a = (triplets[37]>>9)&3;
        donnees.a.legendary_ethernalnight_b = (triplets[37]>>6)&3;
        donnees.a.legendary_ethernalnight_c = (triplets[37]>>3)&3;
        donnees.a.legendary_kingundead_a = (triplets[37])&3;

        donnees.a.legendary_kingundead_b = (triplets[38]>>21)&3;
        donnees.a.legendary_kingundead_c = (triplets[38]>>18)&3;
        donnees.a.legendary_legmagician_a = (triplets[38]>>15)&3;
        donnees.a.legendary_legmagician_b = (triplets[38]>>12)&3;
        donnees.a.legendary_legmagician_c = (triplets[38]>>9)&3;
        donnees.a.legendary_dragonkinght_a = (triplets[38]>>6)&3;
        donnees.a.legendary_dragonkinght_b = (triplets[38]>>3)&3;
        donnees.a.legendary_dragonkinght_c = (triplets[38])&3;

        donnees.d.legendary_sovereign_a = (triplets[39]>>21)&3;
        donnees.d.legendary_sovereign_b = (triplets[39]>>18)&3;
        donnees.d.legendary_sovereign_c = (triplets[39]>>15)&3;
        donnees.d.legendary_legwarrior_a = (triplets[39]>>12)&3;
        donnees.d.legendary_legwarrior_b = (triplets[39]>>9)&3;
        donnees.d.legendary_legwarrior_c = (triplets[39]>>6)&3;
        donnees.d.legendary_magehunter_a = (triplets[39]>>3)&3;
        donnees.d.legendary_magehunter_b = (triplets[39])&3;

        donnees.d.legendary_magehunter_c = (triplets[40]>>21)&3;
        donnees.d.legendary_legpaladin_a = (triplets[40]>>18)&3;
        donnees.d.legendary_legpaladin_b = (triplets[40]>>15)&3;
        donnees.d.legendary_legpaladin_c = (triplets[40]>>12)&3;
        donnees.d.legendary_ethernalnight_a = (triplets[40]>>9)&3;
        donnees.d.legendary_ethernalnight_b = (triplets[40]>>6)&3;
        donnees.d.legendary_ethernalnight_c = (triplets[40]>>3)&3;
        donnees.d.legendary_kingundead_a = (triplets[40])&3;

        donnees.d.legendary_kingundead_b = (triplets[38]>>21)&3;
        donnees.d.legendary_kingundead_c = (triplets[38]>>18)&3;
        donnees.d.legendary_legmagician_a = (triplets[38]>>15)&3;
        donnees.d.legendary_legmagician_b = (triplets[38]>>12)&3;
        donnees.d.legendary_legmagician_c = (triplets[38]>>9)&3;
        donnees.d.legendary_dragonkinght_a = (triplets[38]>>6)&3;
        donnees.d.legendary_dragonkinght_b = (triplets[38]>>3)&3;
        donnees.d.legendary_dragonkinght_c = (triplets[38])&3;
    }
    return donnees;
}
function encode_donnees_heros(donnees){
    var triplets=[0];
    var version=2;
    triplets[0]|=(version&63)<<18;
    triplets[0]|=(donnees.faction&7)<<15;
    triplets[0]|=(donnees.portrait&31)<<10;
    triplets[0]|=(donnees.archetype&15)<<6;
    triplets[0]|=(donnees.niveau&63);
    triplets[1]|=(donnees.bonus_tenancier&3)<<22;
    triplets[1]|=(donnees.respecialisations&31)<<17;
    triplets[1]|=(donnees.graals&31)<<12;
    triplets[1]|=(donnees.dolmens&15)<<8;
    triplets[1]|=(donnees.guildes[0]&15)<<4;
    triplets[1]|=(donnees.guildes[1]&15);
    triplets[2]|=(donnees.guildes[2]&15)<<20;
    triplets[2]|=(donnees.guildes[3]&15)<<16;
    triplets[2]|=(donnees.revelation_de_talents&15)<<12;
    triplets[2]|=(donnees.mysticisme&15)<<8;
    triplets[2]|=(donnees.heros_superieur&15)<<4;
    triplets[2]|=(donnees.heros_talentueux&15);
    triplets[3]|=(donnees.maitrise_des_sorts&15)<<20;
    triplets[3]|=(donnees.revelation_de_caracteristiques&15)<<16;
    triplets[3]|=(donnees.relever_les_morts&15)<<12;
    triplets[3]|=(donnees.resistance_magique&15)<<8;
    triplets[3]|=(donnees.moral_eleve&15)<<4;
    triplets[3]|=(donnees.resurrection&15);
    triplets[4]|=(donnees.tir_de_barrage&15)<<20;
    triplets[4]|=(donnees.recrutement_quotidien&15)<<16;
    triplets[4]|=(donnees.contribution_populaire&15)<<12;
    triplets[4]|=(donnees.richesse_personnelle&15)<<8;
    triplets[4]|=(donnees.butin_de_guerre&15)<<4;
    triplets[4]|=(donnees.carrieres[1]&15);
    triplets[5]|=(donnees.carrieres[2]&15)<<20;
    triplets[5]|=(donnees.carrieres[3]&15)<<16;
    for(var a=0;a<8;a++){
        var paquet=Math.ceil((a+2)/3)+4;
        var position=(2-((a+1)%3))*8;
        triplets[paquet]|=(donnees.artefacts[a]&255)<<position
    }
    triplets[8]|=(donnees.bonus_ap&127)<<17;
    triplets[8]|=(donnees.bonus_dp&127)<<10;
    triplets[8]|=(donnees.bonus_mp&127)<<3;
    triplets[8]|=(donnees.classement_voies&7);
    triplets[9]|=(donnees.bonus_a&63)<<18;
    triplets[9]|=(donnees.bonus_d&63)<<12;
    triplets[9]|=(donnees.bonus_m&63)<<6;
    triplets[9]|=(donnees.competence&63);
    var x=0;
    for(var c in _carrieres){
        for(var t in _talents[c]){
            var paquet=Math.ceil(++x/12)+9;
            var position=(11-((x-1)%12))*2;
            triplets[paquet]|=(donnees.talents[c][t]&3)<<position
        }
    }
    triplets[14]|=(donnees.competence_utilisee&63)<<14;
    var code='';
    for(var t in triplets){
        code+=_base64.charAt((triplets[t]>>18)&63);
        code+=_base64.charAt((triplets[t]>>12)&63);
        code+=_base64.charAt((triplets[t]>>6)&63);
        code+=_base64.charAt((triplets[t])&63)
    }
    return code
}
function decode_donnees_heros(code){
    if(code.length!=44&&code.length!=60)return false;
    var reg=/^[A-Za-z0-9_-]{44}|[A-Za-z0-9_-]{60}$/;
    if(!reg.test(code))return false;
    var triplets=[];
    for(var c=0;c<code.length;c++){
        var i=Math.floor(c/4);
        var d=(3-(c%4))*6;
        triplets[i]|=_base64.indexOf(code.charAt(c))<<d
    }
    var donnees={
        artefacts:[],
        carrieres:[],
        talents:[],
        guildes:[],
        competences_hereditaires:{}
    };

    if(code.length==44){
        donnees.faction=(triplets[0]>>22)&3;
        donnees.portrait=(triplets[0]>>17)&31;
        donnees.archetype=(triplets[0]>>13)&15;
        donnees.niveau=(triplets[0]>>7)&63;
        donnees.bonus_tenancier=(triplets[0]>>5)&3;
        donnees.respecialisations=(triplets[0])&31;
        for(var a=0;a<8;a++){
            var paquet=Math.ceil((a+1)/3);
            var position=(2-(a%3))*8;
            donnees.artefacts[a]=(triplets[paquet]>>position)&255
        }
        donnees.carrieres[1]=(triplets[3]>>4)&15;
        donnees.carrieres[2]=(triplets[3])&15;
        donnees.carrieres[3]=(triplets[4]>>20)&15;
        donnees.bonus_a=(triplets[4]>>14)&63;
        donnees.bonus_d=(triplets[4]>>8)&63;
        donnees.bonus_m=(triplets[4]>>2)&63;
        var version_base_arte=(triplets[4]>>1)&1;
        var version=(triplets[4])&1;
        donnees.bonus_ap=(triplets[5]>>17)&127;
        donnees.bonus_dp=(triplets[5]>>10)&127;
        donnees.bonus_mp=(triplets[5]>>3)&127;
        if(version>=1)donnees.faction=triplets[5]&7;
        var x=0;
        for(var c in _carrieres){
            donnees.talents[c]=[];
            for(var t in _talents[c]){
                var paquet=Math.ceil(++x/12)+5;
                var position=(11-((x-1)%12))*2;
                donnees.talents[c][t]=(triplets[paquet]>>position)&3
            }
        }
        donnees.competence=(triplets[10]>>14)&63;
        donnees.competence_utilisee=(triplets[10]>>8)&63;
        if(version_base_arte==0)for(var a=0;a<8;a++){
            if(_base_arte[donnees.artefacts[a]]!==undefined)donnees.artefacts[a]=_base_arte[donnees.artefacts[a]]
        }
    }else{
        var version=(triplets[0]>>18)&63;
        donnees.faction=(triplets[0]>>15)&7;
        donnees.portrait=(triplets[0]>>10)&31;
        donnees.archetype=(triplets[0]>>6)&15;
        donnees.niveau=(triplets[0])&63;
        donnees.bonus_tenancier=(triplets[1]>>22)&3;
        donnees.respecialisations=(triplets[1]>>17)&31;
        donnees.graals=(triplets[1]>>12)&31;
        donnees.dolmens=(triplets[1]>>8)&15;
        donnees.guildes[0]=(triplets[1]>>4)&15;
        donnees.guildes[1]=(triplets[1])&15;
        donnees.guildes[2]=(triplets[2]>>20)&15;
        donnees.guildes[3]=(triplets[2]>>16)&15;
        donnees.revelation_de_talents=(triplets[2]>>12)&15;
        donnees.mysticisme=(triplets[2]>>8)&15;
        donnees.heros_superieur=(triplets[2]>>4)&15;
        donnees.heros_talentueux=(triplets[2])&15;
        donnees.maitrise_des_sorts=(triplets[3]>>20)&15;
        donnees.revelation_de_caracteristiques=(triplets[3]>>16)&15;
        donnees.relever_les_morts=(triplets[3]>>12)&15;
        donnees.resistance_magique=(triplets[3]>>8)&15;
        donnees.moral_eleve=(triplets[3]>>4)&15;
        donnees.resurrection=(triplets[3])&15;
        donnees.tir_de_barrage=(triplets[4]>>20)&15;
        donnees.recrutement_quotidien=(triplets[4]>>16)&15;
        donnees.contribution_populaire=(triplets[4]>>12)&15;
        donnees.richesse_personnelle=(triplets[4]>>8)&15;
        donnees.butin_de_guerre=(triplets[4]>>4)&15;
        donnees.carrieres[1]=(triplets[4])&15;
        donnees.carrieres[2]=(triplets[5]>>20)&15;
        donnees.carrieres[3]=(triplets[5]>>16)&15;
        for(var a=0;a<8;a++){
            var paquet=Math.ceil((a+2)/3)+4;
            var position=(2-((a+1)%3))*8;
            donnees.artefacts[a]|=(triplets[paquet]>>position)&255
        }
        donnees.bonus_ap=(triplets[8]>>17)&127;
        donnees.bonus_dp=(triplets[8]>>10)&127;
        donnees.bonus_mp=(triplets[8]>>3)&127;
        donnees.classement_voies=(triplets[8])&7;
        donnees.bonus_a=(triplets[9]>>18)&63;
        donnees.bonus_d=(triplets[9]>>12)&63;
        donnees.bonus_m=(triplets[9]>>6)&63;
        donnees.competence=(triplets[9])&63;
        var x=0;
        for(var c in _carrieres){
            donnees.talents[c]=[];
            for(var t in _talents[c]){
                var paquet=Math.ceil(++x/12)+9;
                var position=(11-((x-1)%12))*2;
                donnees.talents[c][t]|=(triplets[paquet]>>position)&3
            }
        }
        donnees.competence_utilisee|=(triplets[14]>>14)&63
    }
    return donnees
}